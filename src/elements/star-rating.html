<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">


<dom-module id="star-rating">
  <template>

    <style>
      .star-rating-wrapper {
        unicode-bidi: bidi-override;
        direction: rtl;
        text-align: center;
      }
      .star-rating-wrapper > span {
        display: inline-block;
        position: relative;
        width: 1em;
        font-size: 1.5em;
        cursor: pointer;
        opacity: 0.4;
      }

      paper-icon-button {
        color: var(--paper-pink-500);
        --paper-icon-button-ink-color: var(--paper-indigo-500);
      }
      .star-rating-wrapper > span.active,
      .star-rating-wrapper > span.active ~ span {
        opacity: 1;
      }

    </style>

    <div class="star-rating-wrapper" session-id$="[[sessionId]]">
      <template id="star" is="dom-repeat" items="{{currentStars}}">
      <span class$="{{isActive(index, rate, sessionId)}}" on-tap="_setRate" data-index$="{{index}}">
        	<paper-icon-button icon="star"></paper-icon-button>
      </span>
      </template>
    </div>
  </template>
<script>
  ( function () {
    Polymer({
      is: 'star-rating',
      properties: {

        stars: {
          type: Number,
          value: 5
        },

        sessionId: {
          type: Number,
          reflectToAttribute: true,
          notify: true
        },

        icon: {
          type: String,
          value: 'star'
        },

        rate: {
          type: Number,
          value: 0
        },

        currentStars: {
          type: Object,
          value: []
        },
      },

      ready: function() {
        this.currentStars = [];
        for (var i = this.stars - 1; i >= 0; i--) {
          this.currentStars.push(i+1);
        };
      },

      isActive: function(index, rate, sessionId) {
        if ((index - this.stars) * -1 == rate && this.sessionId == sessionId) {
          return "active";
        }
      },

      _setRate: function(e) {

        deep = Polymer.dom(this.root);
        if(!this.readonly){
          var index = e.model.index;
          var indexOld = (this.rate * -1) + this.stars;
          this.rate = (index - this.stars) * -1;
          if (indexOld < this.stars) {
            deep.querySelector('[session-id="'+this.sessionId+'"] [data-index="'+ indexOld +'"]').classList.remove("active");
          }
          deep.querySelector('[session-id="'+this.sessionId+'"] [data-index="'+ index +'"]').classList.add("active");
        }
      }
    });
  })();
</script>

</dom-module>
