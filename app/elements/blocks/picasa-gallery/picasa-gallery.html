<link rel="import" href="../../../bower_components/polymer/polymer.html">

<link rel="import" href="../../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../../bower_components/iron-list/iron-list.html">
<link rel="import" href="../../../bower_components/iron-image/iron-image.html">

<dom-module id="photo-gallery">
    <template>
        <style>
            :host {
                display: block;
            }

            iron-list {
                height: 100%;
                width: 100%;
                position: relative;
                box-sizing: border-box;
                overflow-y: auto;
            }

            .photos-wrapper {
                background: rgba(0, 0, 0, .8);
            }

            .item {
                height: 80vh;
            }

            .photo {
                margin: 20px 0;
            }

            @media (min-width: 601px) {
                iron-list {
                    width: 80%;
                }
            }
        </style>
        <!-- <iron-ajax auto id="ajax" url="https://picasaweb.google.com/data/feed/api/user/[[userId]]/albumid/[[albumId]]?alt=json'" handle-as="json" on-response="_photosLoaded"></iron-ajax> -->
        <iron-ajax auto id="ajax" url="[[ albumUrl ]]" handle-as="json" on-response="_photosLoaded"></iron-ajax>
        <div class="photos-wrapper layout horizontal center-center fit">
            <iron-list class="layout vertical" items="[[ photos ]]" as="photo">
                <template>
                    <div class="item">
                        <iron-image src="[[ photo.content.src ]]" class="placeholder-color photo fit" preload fade sizing="cover"></iron-image>
                    </div>
                </template>
            </iron-list>
        </div>
    </template>
    <script>
        (function() {
            'use strict';

            class PicasaGallery {
                beforeRegister() {
                    let is = this.constructor.name.replace(/\W+/g, '-')
                        .replace(/([a-z\d])([A-Z])/g, '$1-$2').toLowerCase();
                    this.is = is;
                    this.properties = {
                        userId: String,
                        albumId: String
                    };
                    this.observers = [
                        '_generateAlbumUrl(userId, albumId)'
                    ];
                }
                _generateAlbumUrl(userId, albumId) {
                    this.albumUrl = 'https://picasaweb.google.com/data/feed/api/user/' + userId + '/albumid/' + albumId + '?alt=json';
                    // this.$.ajax.generateRequest();
                }
                _photosLoaded(event, response) {
                    this.photos = response.response.feed.entry;
                }
            }

            Polymer(PicasaGallery);
        })();
    </script>
</dom-module>
