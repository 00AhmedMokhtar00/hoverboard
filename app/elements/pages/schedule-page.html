<link rel="import" href="../../../bower_components/polymer/polymer.html">

<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../../bower_components/iron-image/iron-image.html">
<link rel="import" href="../../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../../bower_components/neon-animation/neon-animatable.html">
<link rel="import" href="../../../bower_components/neon-animation/animations/slide-from-top-animation.html">


<link rel="import" href="../blocks/footer-block/footer-block.html">

<dom-module id="schedule-page">
    <template>
        <style include="shared-styles"></style>
        <style>
            :host {
                display: block;
                --paper-tabs-selection-bar-color: #fff;
                --paper-tab-ink: rgba(255, 255, 255, 0.2);
                --paper-tab-content: {
                    font-weight: 400 !important;
                };
                --paper-tab: {
                    color: #fff;
                    font-weight: 400;
                    text-transform: uppercase;
                    flex: none;
                };
            }

            .schedule-container {
                @apply(--layout-vertical);
            }

            .schedule-tabs {
                margin-top: -66px;
            }

            /*OLD CODE*/

            .schedule-icon {
                --iron-icon-height: 20px;
                --iron-icon-width: 20px;
            }

            .track {
                width: 40px;
            }

            .track-dot span {
                margin: 7px 0 0 8px;
                width: 10px;
                height: 10px;
                display: block;
                border-radius: 50%;
            }

            .session {
                background: #fff;
            }

            .sub-session {
                padding: 10px 16px;
                background: none !important;
                color: inherit !important;
                cursor: pointer;
            }

            .session:last-of-type .sub-sessio:last-of-type {
                padding-bottom: 0;
            }

            .session-title {
                margin-bottom: 10px;
                font-weight: 300;
                font-size: 20px;
                line-height: 1.1;
                color: var(--primary-text-color);
            }

            .start-time {
                margin: 25px 0 10px 10px;
                font-size: 14px;
                font-weight: 400;
                color: var(--secondary-text-color);
            }

            .session-meta {
                margin-top: 10px;
                font-size: 14px;
                color: var(--disabled-text-color);
            }

            .meta-block {
                margin-right: 10px;
            }

            .session-meta-icon {
                --iron-icon-height: 18px;
                --iron-icon-width: 18px;
            }

            .lang {
                margin: 4px 0 0 10px;
                text-transform: uppercase;
                font-size: 12px;
                color: var(--secondary-text-color);
            }

            .speaker {
                margin-top: 5px;
                color: var(--secondary-text-color);
            }

            .speaker-img {
                margin-right: 10px;
                height: 30px;
                width: 30px;
            }

            .person-name {
                font-size: 18px;
                line-height: 1;
            }

            .person-title {
                font-size: 14px;
                color: var(--disabled-text-color);
            }

            @media (max-width: 960px) {
                .container {
                    padding: 40px 0;
                }

                .sessions-wrapper {
                    padding: 10px 0;
                    background: #fff;
                    box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
                }

                .dialog-wrapper {
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    padding: 0;
                    margin: 0;
                }
            }

            @media (min-width: 961px) {
                .schedule {
                    margin-top: 10px;
                }

                .tracks-header {
                    margin-top: 5px;
                    color: var(--secondary-text-color);
                    text-transform: uppercase;
                }

                .start-time {
                    margin: 15px 10px;
                    font-size: 20px;
                    font-weight: 300;
                }

                .timeslot {
                    margin-bottom: 10px;
                }

                .track {
                    width: 30px;
                }

                .track-dot span {
                    margin-left: 4px;
                }

                .session {
                    margin: 0 10px;
                    box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
                }

                .sub-session {
                    padding: 20px 16px;
                    border-top: 3px solid;
                }

                .dialog-wrapper {
                    width: 50%;
                    min-height: 90% !important;
                    max-height: 90% !important;
                }
            }

        </style>
        <div class="container page-header" cascaded>
            <div class="page-title">
                <h3>Schedule</h3>
            </div>
        </div>
        <div class="container schedule-container">
            <paper-tabs class="schedule-tabs" selected="{{_selectedDay}}">
                <template is="dom-repeat" items="[[schedule]]" as="day">
                    <paper-tab>[[day.dateReadable]]</paper-tab>
                </template>
            </paper-tabs>

            <neon-animated-pages selected="{{_selectedDay}}" entry-animation="[[_entryAnimation]]"
                                 exit-animation="[[_exitAnimation]]">
                <template is="dom-repeat" items="[[schedule]]" as="day">
                    <neon-animatable>
                        <template is="dom-repeat" items="[[day.timeslots]]" as="timeslot">
                            <div class="timeslot layout vertical">
                                <div class="start-time">
                                    <iron-icon class="schedule-icon" icon="schedule"></iron-icon>
                                    <span>[[timeslot.startTime]]</span>
                                </div>
                                <div class="sessions-wrapper layout vertical-horizontal flex">
                                    <template is="dom-repeat" items="[[timeslot.sessions]]" as="session">
                                        <div class="session layout vertical flex" cascaded>
                                            <template is="dom-repeat" items="[[session]]" as="subSession">
                                                <div class$="sub-session layout horizontal [[subSession.mainTag]]"
                                                     on-tap="_sessionTap">
                                                    <div class="track track-dot">
                                                        <span class$="[[subSession.mainTag]]"></span>
                                                    </div>
                                                    <div class="session-detail layout vertical flex">
                                                        <div class="layout horizontal">
                                                            <h4 class="session-title flex">[[subSession.title]]</h4>
                                                            <span class="lang">[[subSession.language]]</span>
                                                        </div>
                                                        <template is="dom-repeat" items="[[subSession.speakers]]"
                                                                  as="speaker">
                                                            <div class="speaker layout horizontal">
                                                                <iron-image src="[[speaker.photoUrl]]"
                                                                            class="speaker-img placeholder-color img-circle"
                                                                            preload fade sizing="cover"></iron-image>
                                                                <div
                                                                    class="person-detail flex layout vertical center-center">
                                                                    <span class="person-name self-start">[[speaker.name]]</span>
                                                                    <div class="person-title self-start">
                                                                        <span>[[speaker.company]]</span>,
                                                                        <span>[[speaker.country]]</span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </template>
                                                        <div class="session-meta layout horizontal">
                                                            <div class="meta-block">
                                                                <iron-icon class="session-meta-icon"
                                                                           icon="restore"></iron-icon>
                                                                <span>[[subSession.endTime]]</span>
                                                            </div>
                                                            <div class="meta-block">
                                                                <iron-icon class="session-meta-icon"
                                                                           icon="room"></iron-icon>
                                                                <span>[[subSession.track.title]]</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </template>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </template>
                    </neon-animatable>
                </template>
                <footer-block mailchimp-url="{$ mailchimp.url $}" mailchimp-name="{$ mailchimp.name $}"
                              cascaded></footer-block>
            </neon-animated-pages>
        </div>
    </template>
</dom-module>

<script>
    (function () {
        'use strict';

        Polymer({

            is: 'schedule-page',

            behaviors: [
                Polymer.NeonSharedElementAnimatableBehavior
            ],

            properties: {
                schedule: {
                    type: Array,
                    observer: 'justTest'
                },
                sessions: Array,
                selected: {
                    type: Boolean,
                    observer: 'updateHeroSettings'
                },
                heroSettings: {
                    type: Object,
                    notify: true
                },
                sessionId: {
                    type: Object,
                    observer: 'openSessionDetails'
                },
                _entryAnimation: {
                    type: String,
                    value: 'slide-up-animation'
                },
                _exitAnimation: {
                    type: String,
                    value: 'slide-down-animation'
                },
                _selectedDay: {
                    type: Number,
                    value: 0,
                    observer: '_changeDay'
                },
                _heroSettings: {
                    type: Object,
                    /* jshint ignore:start */
                    value: function () {
                        return {% for nav in navigation %}{% if nav.route == 'schedule' %}{$ nav.heroSettings | dump $}{% endif %}{% endfor %};
                    }
                    /* jshint ignore:end */
                },

                animationConfig: {
                    type: Object,
                    value: function () {
                        return {
                            'entry': [{
                                name: 'fade-in-animation',
                                animation: 'fade-in-animation',
                                node: this,
                                timing: {
                                    delay: 500
                                }
                            }],
                            'exit': [{
                                name: 'fade-out-animation',
                                animation: 'fade-out-animation',
                                node: this
                            }]
                        };
                    }
                }
            },

            updateHeroSettings: function () {
                this.heroSettings = this.selected ? this._heroSettings : this.heroSettings;
            },

            justTest: function () {
                console.log(this.schedule);
            },

            openSessionDetails: function () {

            },

            _changeDay: function (newValue, oldValue) {
                if (window.innerWidth < 961) {
                    this._entryAnimation = newValue < oldValue ? 'slide-from-right-animation' : 'slide-from-left-animation';
                    this._exitAnimation = newValue < oldValue ? 'slide-left-animation' : 'slide-right-animation';
                } else {
                    this._entryAnimation = 'slide-up-animation';
                    this._exitAnimation = 'slide-down-animation';
                }
            },

            _updateCascadedNodes: function () {
                var cascaded = Polymer.dom(this.root).querySelectorAll('[cascaded]');
                var cascadedArray = Array.prototype.slice.call(cascaded);
                this.animationConfig.entry.push({
                    name: 'cascaded-animation',
                    animation: 'transform-animation',
                    transformFrom: 'translate3d(0, 100%, 0)',
                    timing: {
                        delay: 500
                    },
                    nodes: cascadedArray
                });
                this.animationConfig.exit.push({
                    name: 'cascaded-animation',
                    animation: 'transform-animation',
                    transformTo: 'translate3d(0, 100%, 0)',
                    nodes: cascadedArray
                });
            }
        });

    })();
</script>
